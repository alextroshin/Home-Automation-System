# API сервиса управления устройствами


| Ресурс                      | Метод  | Что делает                                                | Доступ       |
| -----------                 | -----  | ---                                                       | ---          |
| /devices                    | GET    | Возвращает список зарегистрированных устройств и датчиков | Пользователь |
| /devices                    | POST   | Позволяет пользователю зарегистрировать устройство        | Пользователь |
| /devices                    | PUT    | Позволяет пользователю переконфигурировать устройство     | Пользователь |
| /devices/{deviceId}         | GET    | Возвращает информацию о устройстве                        | Пользователь |
| /devices/{deviceId}         | DELETE | Позволяет пользователю удалить устройство                 | Пользователь |
| /devices/{deviceId}/command | POST   | Посылает команду устройству                               | Пользователь |
| /devices/{deviceId}/fetch   | GET    | Инициирует получение актуальных данных с устройства       | Пользователь |    


# Зависимости

Перед запуском сервиса необходимо установить зависимости из файла requirements.txt

# Запуск

```bash
uvicorn app:app --port 5000 --reload
```

или

```bash
./run.sh
```

# Запуск с использование файла конфигурации .env

Для запуска из файла конфигурации нужно поместить файл .env в корень сервиса

# Запуск с переопределением переменных окружения

```bash
uvicorn app:app --port 5000 --reload
```

или

```bash
export POSTGRES_DSN=postgresql://home-automation:home-automation@192.168.1.50:5432/home-automation
uvicorn app:app --port 5000 --reload
```

# Конфигурация
| Переменная    | Назначение                      | Значение по-умолчанию                        |
| -----------   | -----                           | ---                                          |
| POSTGRES_DSN  | Строка подключения к PostgreSQL | postgresql://user:pass@localhost:5432/foobar |
| INT_EXAMPLE   | Пример целочисленной переменной | 5                                            | 
| BOOL_EXAMPLE  | Пример булевой переменной       | False                                        | 

# Документация

После запуска доступна документация: http://127.0.0.1:5000/docs


# Модули сервиса

- App - Точка входа в приложение, реализует FastAPI-приложение соответсвии с требованиями
- Schemas - Реализует Pydantic-схемы сущностей приложения
- Database - Реализует взаимодействией с базой данных - подключение к ней и sqalchemy-модели
- CRUD - Реализует CRUD-методы для работы с сущностями сервиса
- Config - Отвечает за подгрузку конфигурации


```mermaid
graph TD
    App --> CRUD
    App --> Database
    CRUD --> Database
    CRUD --> Schemas
    App --> Schemas
    App --> Config
```